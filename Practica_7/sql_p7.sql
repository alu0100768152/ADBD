-- MySQL Script generated by MySQL Workbench
-- Tue Dec  4 17:39:17 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

#SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
#SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
#SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
#CREATE SCHEMA IF NOT EXISTS mydb DEFAULT CHARACTER SET utf8 ;
#USE mydb ;

-- -----------------------------------------------------
-- Table Medicamento
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Medicamento (
  cod_medicamento INT NOT NULL,
  nombre VARCHAR(45) NOT NULL,
  stock INT NOT NULL,
  precio FLOAT NOT NULL,
  tipo VARCHAR(45) NOT NULL,
  vendidos INT NOT NULL,
  tipo_receta VARCHAR(45) NOT NULL,
  PRIMARY KEY (cod_medicamento));

CREATE UNIQUE INDEX nombre_UNIQUE ON Medicamento (nombre);


-- -----------------------------------------------------
-- Table Laboratorio
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Laboratorio (
  cod_laboratorio INT NOT NULL,
  nombre VARCHAR(45) NOT NULL,
  direccion VARCHAR(45) NOT NULL,
  telefono INT NOT NULL,
  fax INT NULL,
  contacto VARCHAR(45) NULL,
  PRIMARY KEY (cod_laboratorio));

CREATE UNIQUE INDEX nombre_UNIQUE ON Laboratorio (nombre);


-- -----------------------------------------------------
-- Table Cliente_credito
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Cliente_credito (
  dni VARCHAR(45) NOT NULL,
  datos_bancarios VARCHAR(45) NOT NULL,
  PRIMARY KEY (dni));


-- -----------------------------------------------------
-- Table Familia
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Familia (
  enfermedad VARCHAR(45) NOT NULL,
  PRIMARY KEY (enfermedad));


-- -----------------------------------------------------
-- Table Compra
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Compra (
  cod_compra INT NOT NULL,
  PRIMARY KEY (cod_compra))
;


-- -----------------------------------------------------
-- Table Compra_cliente_credito
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Compra_cliente_credito (
  dni VARCHAR(45) NOT NULL,
  cod_compra INT NOT NULL,
  cantidad_ventas INT NOT NULL,
  fecha_compra DATE NOT NULL,
  PRIMARY KEY (dni, cod_compra),
  CONSTRAINT fk_dni
    FOREIGN KEY (dni)
    REFERENCES Cliente_credito (dni)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_cod_compra
    FOREIGN KEY (cod_compra)
    REFERENCES Compra (cod_compra)
    ON DELETE CASCADE
    ON UPDATE CASCADE);

CREATE INDEX fk_cod_compra_idx ON Compra_cliente_credito (cod_compra);


-- -----------------------------------------------------
-- Table Medicamento_compra
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Medicamento_compra (
  cod_compra INT NOT NULL,
  cod_medicamento INT NOT NULL,
  PRIMARY KEY (cod_compra, cod_medicamento),
  CONSTRAINT fk_compra
    FOREIGN KEY (cod_compra)
    REFERENCES Compra (cod_compra)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_med
    FOREIGN KEY (cod_medicamento)
    REFERENCES Medicamento (cod_medicamento)
    ON DELETE CASCADE
    ON UPDATE CASCADE);

CREATE INDEX fk_med_idx ON Medicamento_compra (cod_medicamento);


-- -----------------------------------------------------
-- Table Medicamento_lab
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Medicamento_lab (
  cod_laboratorio INT NOT NULL,
  cod_medicamento INT NOT NULL,
  PRIMARY KEY (cod_laboratorio, cod_medicamento),
  CONSTRAINT fk_medicamento_lab
    FOREIGN KEY (cod_laboratorio)
    REFERENCES Laboratorio (cod_laboratorio)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_lab_medicamento
    FOREIGN KEY (cod_medicamento)
    REFERENCES Medicamento (cod_medicamento)
    ON DELETE CASCADE
    ON UPDATE CASCADE);

CREATE INDEX fk_lab_medicamento_idx ON Medicamento_lab (cod_medicamento);


-- -----------------------------------------------------
-- Table Medicamento_familia
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Medicamento_familia (
  enfermedad VARCHAR(45) NOT NULL,
  cod_medicamento INT NOT NULL,
  PRIMARY KEY (enfermedad, cod_medicamento),
  CONSTRAINT fk_familia
    FOREIGN KEY (enfermedad)
    REFERENCES Familia (enfermedad)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT fk_medicamento
    FOREIGN KEY (cod_medicamento)
    REFERENCES Medicamento (cod_medicamento)
    ON DELETE CASCADE
    ON UPDATE CASCADE);

CREATE INDEX fk_medicamento_idx ON Medicamento_familia (cod_medicamento);


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table Medicamento
-- -----------------------------------------------------

INSERT INTO Medicamento (cod_medicamento, nombre, stock, precio, tipo, vendidos, tipo_receta) VALUES (4321, 'Frenadol', 200, 8.0, 'Anti-gripal', 50, 'Sin Receta');
INSERT INTO Medicamento (cod_medicamento, nombre, stock, precio, tipo, vendidos, tipo_receta) VALUES (8765, 'Ibuprofeno', 350, 3.0, 'Anti-inflamatorio', 100, 'Sin Receta');



-- -----------------------------------------------------
-- Data for table Laboratorio
-- -----------------------------------------------------

INSERT INTO Laboratorio (cod_laboratorio, nombre, direccion, telefono, fax, contacto) VALUES (1234, 'SANFRA', 'Felipe II', 928532114, 928532115, 'Ã“scar');
INSERT INTO Laboratorio (cod_laboratorio, nombre, direccion, telefono, fax, contacto) VALUES (5678, 'GARACHICO', 'Calle del Rey III', 922255255, 922255256, 'Kathrina');



-- -----------------------------------------------------
-- Data for table Cliente_credito
-- -----------------------------------------------------

INSERT INTO Cliente_credito (dni, datos_bancarios) VALUES ('11111111', 'IBAN 7895');
INSERT INTO Cliente_credito (dni, datos_bancarios) VALUES ('22222222', 'IBAN 7892');



-- -----------------------------------------------------
-- Data for table Familia
-- -----------------------------------------------------

INSERT INTO Familia (enfermedad) VALUES ('Anti-inflamatorio');
INSERT INTO Familia (enfermedad) VALUES ('Anti-gripal');



-- -----------------------------------------------------
-- Data for table Compra
-- -----------------------------------------------------

INSERT INTO Compra (cod_compra) VALUES (2587);
INSERT INTO Compra (cod_compra) VALUES (9541);



-- -----------------------------------------------------
-- Data for table Compra_cliente_credito
-- -----------------------------------------------------

INSERT INTO Compra_cliente_credito (dni, cod_compra, cantidad_ventas, fecha_compra) VALUES ('11111111', 2587, 4, '20-11-2018');
INSERT INTO Compra_cliente_credito (dni, cod_compra, cantidad_ventas, fecha_compra) VALUES ('22222222', 9541, 10, '01-12-2018');



-- -----------------------------------------------------
-- Data for table Medicamento_compra
-- -----------------------------------------------------

INSERT INTO Medicamento_compra (cod_compra, cod_medicamento) VALUES (2587, 4321);
INSERT INTO Medicamento_compra (cod_compra, cod_medicamento) VALUES (9541, 8765);



-- -----------------------------------------------------
-- Data for table Medicamento_lab
-- -----------------------------------------------------

INSERT INTO Medicamento_lab (cod_laboratorio, cod_medicamento) VALUES (1234, 4321);
INSERT INTO Medicamento_lab (cod_laboratorio, cod_medicamento) VALUES (5678, 8765);



-- -----------------------------------------------------
-- Data for table Medicamento_familia
-- -----------------------------------------------------

INSERT INTO Medicamento_familia (enfermedad, cod_medicamento) VALUES ('Anti-gripal', 4321);
INSERT INTO Medicamento_familia (enfermedad, cod_medicamento) VALUES ('Anti-inflamatorio', 8765);



